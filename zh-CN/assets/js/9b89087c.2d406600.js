"use strict";(self.webpackChunkalova_website=self.webpackChunkalova_website||[]).push([[760],{5401:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>i});var t=a(85893),s=a(11151);const r={title:"v3 \u5347\u7ea7\u6307\u5357"},l=void 0,o={id:"tutorial/project/migration/v2-to-v3",title:"v3 \u5347\u7ea7\u6307\u5357",description:"\u4ee5\u4e0b\u662f\u4ece alova v2 \u5230 v3 \u7684\u8fc1\u79fb\u6307\u5357\u3002",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/tutorial/07-project/02-migration/01-v2-to-v3.md",sourceDirName:"tutorial/07-project/02-migration",slug:"/tutorial/project/migration/v2-to-v3",permalink:"/zh-CN/tutorial/project/migration/v2-to-v3",draft:!1,unlisted:!1,editUrl:"https://github.com/alovajs/alovajs.github.io/blob/main/docs/tutorial/07-project/02-migration/01-v2-to-v3.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"v3 \u5347\u7ea7\u6307\u5357"},sidebar:"tutorial",previous:{title:"\u670d\u52a1\u7aefL2\u5b58\u50a8\u5b9e\u8df5",permalink:"/zh-CN/tutorial/project/best-practice/l2-storage"},next:{title:"\u4eceaxios\u8fc1\u79fb",permalink:"/zh-CN/tutorial/project/migration/from-axios"}},c={},i=[];function d(n){const e={code:"code",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.a)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.p,{children:"\u4ee5\u4e0b\u662f\u4ece alova v2 \u5230 v3 \u7684\u8fc1\u79fb\u6307\u5357\u3002"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"fetch \u9002\u914d\u5668\u5bfc\u5165\u8def\u5f84\u53d8\u66f4:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nimport GlobalFetch from 'alova/GlobalFetch';\n\n// v3\nimport adapterFetch from 'alova/fetch';\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"2",children:["\n",(0,t.jsx)(e.li,{children:"useRequest/useWatcher/useFetcher \u7b49 hook \u5bfc\u5165\u8def\u5f84\u53d8\u66f4:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nimport { useRequest } from 'alova';\nimport { usePagination, useForm } from '@alova/scene-[vue/react/svelte]';\n\n// v3\nimport { useRequest, usePagination, useForm } from 'alova/client';\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"3",children:["\n",(0,t.jsx)(e.li,{children:"\u7f13\u5b58\u6a21\u5f0f\u91cd\u65b0\u8bbe\u8ba1\uff0cplaceholder \u6a21\u5f0f\u88ab\u79fb\u9664\uff0c\u53ef\u4f7f\u7528 initialData \u51fd\u6570\u5b9e\u73b0\u76f8\u540c\u6548\u679c:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nconst { data } = useRequest(Getter, {\n  placeholder: true\n});\n\n// v3\nconst { data } = useRequest(Getter, {\n  initialData() {\n    // \u8bbe\u7f6e\u4e0a\u4e00\u6b21\u7684\u54cd\u5e94\u6570\u636e\n    const storedData = localStorage.getItem('placeholder-data');\n    return JSON.parse(storedData || '{}');\n\n    // \u4e5f\u4f7f\u7528alova\u7684\u5b58\u50a8\u9002\u914d\u5668\n    // return alovaInst.l2cache.get('placeholder-data');\n  }\n}).onSuccess(({ data, method }) => {\n  // \u4fdd\u5b58\u54cd\u5e94\u6570\u636e\n  localStorage.setItem('placeholder-data', JSON.stringify(data));\n\n  // \u4e5f\u4f7f\u7528alova\u7684\u5b58\u50a8\u9002\u914d\u5668\n  alovaInst.l2cache.set('placeholder-data', data);\n});\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"4",children:["\n",(0,t.jsx)(e.li,{children:"\u7f13\u5b58\u64cd\u4f5c\u51fd\u6570\u53d8\u4e3a\u5f02\u6b65,\u5e76\u652f\u6301\u6307\u5b9a\u7f13\u5b58\u7ea7\u522b:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nsetCache(methodInstance, data);\nconst cache = queryCache(methodInstance);\ninvalidateCache();\n\n// v3\nawait setCache(methodInstance, data, { policy: 'all' });\nconst cache = queryCache(methodInstance);\nawait invalidateCache(methodInstance);\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"5",children:["\n",(0,t.jsx)(e.li,{children:"method \u5feb\u7167\u5339\u914d\u5668\u4f7f\u7528\u65b9\u5f0f\u53d8\u66f4:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\ninvalidateCache('method-name');\n\n// v3\nconst methodSnapshots = alovaInst.snapshots.match('method-name');\ninvalidateCache(methodSnapshots);\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"6",children:["\n",(0,t.jsxs)(e.li,{children:["useWatcher \u7684 ",(0,t.jsx)(e.code,{children:"sendable"})," \u9009\u9879\u88ab\u79fb\u9664,\u4f7f\u7528 ",(0,t.jsx)(e.code,{children:"middleware"})," \u66ff\u4ee3:"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nuseWatcher(() => method, [xxx], { sendable: () => sendable });\n\n// v3\nuseWatcher(() => method, [xxx], {\n  async middleware(_, next) {\n    if (sendable) {\n      return next();\n    }\n  }\n});\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"7",children:["\n",(0,t.jsxs)(e.li,{children:["method \u7684 ",(0,t.jsx)(e.code,{children:"enableDownload/enableUpload"})," \u9009\u9879\u88ab\u79fb\u9664,\u6539\u4e3a\u81ea\u52a8\u5224\u65ad:"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nalova.Get('/api/file', {\n  enableDownload: true\n});\n\n// v3\nalova.Get('/api/file');\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"8",children:["\n",(0,t.jsxs)(e.li,{children:["createAlova \u4e2d ",(0,t.jsx)(e.code,{children:"responsed"})," \u66ff\u4ee3 ",(0,t.jsx)(e.code,{children:"responded"}),":"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\ncreateAlova({\n  responsed() {\n    // ...\n  }\n});\n\n// v3\ncreateAlova({\n  responded() {\n    // ...\n  }\n});\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"9",children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"errorLogger"})," \u53c2\u6570\u88ab\u79fb\u9664,\u9519\u8bef\u5904\u7406\u903b\u8f91\u53d8\u66f4:"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\ncreateAlova({\n  errorLogger: true\n});\n\n// v3\n// \u4e0d\u518d\u9700\u8981\u8bbe\u7f6e,\u81ea\u52a8\u5904\u7406\u9519\u8bef\u65e5\u5fd7\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"10",children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"updateState"})," \u4e0d\u518d\u652f\u6301 method \u5339\u914d\u5668\uff0conMatch \u94a9\u5b50\u88ab\u79fb\u9664:"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nupdateState('method-name', newState, {\n  onMatch: () => {}\n});\n\n// v3\nconst methodSnapshots = alovaInst.snapshots.match('method-name');\nupdateState(methodSnapshots, newState);\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"11",children:["\n",(0,t.jsx)(e.li,{children:"getMethodKey \u51fd\u6570\u5bfc\u5165\u65b9\u5f0f\u53d8\u66f4:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nimport { getMethodKey } from 'alova';\n\n// v3\nimport { key } from '@alova/shared/function';\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"12",children:["\n",(0,t.jsx)(e.li,{children:"middleware \u4e2d context.update \u51fd\u6570\u548c\u88c5\u9970\u51fd\u6570\u88ab\u79fb\u9664:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nmiddleware(({ update }) => {\n  update({ loading: true });\n});\n\n// v3\nmiddleware(({ proxyStates }) => {\n  proxyStates.loading.v = true;\n});\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"13",children:["\n",(0,t.jsxs)(e.li,{children:["@alova/vue-options \u4e2d ",(0,t.jsx)(e.code,{children:"mapWatcher"})," \u88ab\u79fb\u9664:"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nexport default {\n  watch: mapWatcher({\n    'testRequest.data'() {\n      // ...\n    }\n  })\n}\n\n// v3\nexport default {\n  watch: {\n    'testRequest.data'() {\n      // ...\n    }\n  }\n}\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"14",children:["\n",(0,t.jsx)(e.li,{children:"usePagination \u5728 React \u4e2d\u4f7f\u7528\u65b9\u5f0f\u53d8\u66f4:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nconst {\n  page: [page, setPage],\n  pageSize: [pageSize, setPageSize]\n} = usePagination(/*...*/);\nsetPage(page + 1);\n\n// v3\nconst { page, pageSize, update } = usePagination(/*...*/);\nupdate({ page: page + 1 });\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"15",children:["\n",(0,t.jsx)(e.li,{children:"useForm \u4e0d\u518d\u652f\u6301\u76f4\u63a5\u4f20\u5165 id \u8fd4\u56de\u7f13\u5b58\u7684 hookReturns:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nconst states = useForm('form-id');\n\n// v3\nconst { states } = useForm(formData => methodHandler(formData), {\n  id: 'form-id'\n});\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"16",children:["\n",(0,t.jsx)(e.li,{children:"SilentMethod \u76f8\u5173\u65b9\u6cd5\u53d8\u4e3a\u5f02\u6b65:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nsilentMethod.replace(newSilentMethod);\n\n// v3\nawait silentMethod.replace(newSilentMethod);\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"17",children:["\n",(0,t.jsxs)(e.li,{children:["accessAction \u65b0\u589e ",(0,t.jsx)(e.code,{children:"silent"})," \u53c2\u6570\uff0c\u6ca1\u6709\u5339\u914d\u5230\u65f6\u4e0d\u518d\u629b\u51fa\u9519\u8bef\u3002"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\naccessAction('method-name', ({ send }) => {\n  send();\n});\n\n// v3\naccessAction(\n  'method-name',\n  ({ send }) => {\n    send();\n  },\n  true\n);\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"18",children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"method.__key__"})," \u7b80\u5316\u4e3a method.key:"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nmethod.__key__ = 'custom-key';\n\n// v3\nmethod.key = 'custom-key';\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"19",children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"method.transformData"})," \u7b80\u5316\u4e3a method.transform:"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nalova.Get('/api/profile', {\n  transformData(data) {\n    return data.detail;\n  }\n});\n\n// v3\nalova.Get('/api/profile', {\n  transform(data) {\n    return data.detail;\n  }\n});\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"20",children:["\n",(0,t.jsx)(e.li,{children:"method.localCache \u66f4\u6539\u4e3a method.cacheFor:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nalova.Get('/api/profile', {\n  localCache: 1000 * 60 * 60\n});\n\n// v3\nalova.Get('/api/profile', {\n  cacheFor: 1000 * 60 * 60\n});\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"21",children:["\n",(0,t.jsx)(e.li,{children:"\u6240\u6709\u7684 sendArgs \u66f4\u6539\u4e3a args:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nonSuccess(({ sendArgs }) => {\n  // ...\n});\n\n// v3\nonSuccess(({ args }) => {\n  // ...\n});\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"22",children:["\n",(0,t.jsx)(e.li,{children:"@alova/adapter-uniapp \u5bfc\u51fa\u540d\u79f0\u4fee\u6539:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nimport { uniappStorageAdapter } from '@alova/adapter-uniapp';\n\n// v3\nimport { uniappL2CacheAdapter } from '@alova/adapter-uniapp';\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"23",children:["\n",(0,t.jsx)(e.li,{children:"middleware \u4e2d\u4f7f\u7528 proxyState \u8bbf\u95ee\u548c\u4fee\u6539\u72b6\u6001:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nmiddleware(({ states, update }) => {\n  const loading = states.loading;\n  update({\n    loading: true\n  });\n});\n\n// v3\nmiddleware(({ proxyStates }) => {\n  proxyStates.loading.v = true;\n});\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"24",children:["\n",(0,t.jsx)(e.li,{children:"\u4e8b\u4ef6\u7ed1\u5b9a\u51fd\u6570\u8fd4\u56de\u81ea\u8eab\u5bf9\u8c61,\u652f\u6301\u94fe\u5f0f\u8c03\u7528:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nconst { onSuccess, loading, data } = useRequest(method);\nonSuccess(() => {\n  /*...*/\n});\n\n// v3\nconst { loading, data } = useRequest(method).onSuccess(() => {\n  /*...*/\n});\n"})}),"\n",(0,t.jsxs)(e.ol,{start:"25",children:["\n",(0,t.jsxs)(e.li,{children:["\u4f7f\u7528",(0,t.jsx)(e.code,{children:"alova.snapshots.match"}),"\u83b7\u53d6\u5df2\u8bbf\u95ee\u8fc7\u7684 method \u5b9e\u4f8b\u5feb\u7167\uff1a"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:"// v2\nconst methodSnapshots = matchSnapshotMethod('method-name');\n\n// V3\nconst methodSnapshots = alova.snapshots.match('method-name');\n"})})]})}function h(n={}){const{wrapper:e}={...(0,s.a)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},11151:(n,e,a)=>{a.d(e,{Z:()=>o,a:()=>l});var t=a(67294);const s={},r=t.createContext(s);function l(n){const e=t.useContext(r);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:l(n.components),t.createElement(r.Provider,{value:e},n.children)}}}]);