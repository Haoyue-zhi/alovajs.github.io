"use strict";(self.webpackChunkalova_website=self.webpackChunkalova_website||[]).push([[7249],{99577:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>i,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var t=a(85893),s=a(11151);const o={title:"v3 upgrade guidelines"},r=void 0,c={id:"tutorial/project/migration/v2-to-v3",title:"v3 upgrade guidelines",description:"The following is a migration guide from alova v2 to v3.",source:"@site/docs/tutorial/07-project/02-migration/01-v2-to-v3.md",sourceDirName:"tutorial/07-project/02-migration",slug:"/tutorial/project/migration/v2-to-v3",permalink:"/tutorial/project/migration/v2-to-v3",draft:!1,unlisted:!1,editUrl:"https://github.com/alovajs/alovajs.github.io/blob/main/docs/tutorial/07-project/02-migration/01-v2-to-v3.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"v3 upgrade guidelines"},sidebar:"tutorial",previous:{title:"l2-storage",permalink:"/tutorial/project/best-practice/l2-storage"},next:{title:"Migrate from axios",permalink:"/tutorial/project/migration/from-axios"}},i={},l=[];function d(e){const n={code:"code",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"The following is a migration guide from alova v2 to v3."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Changes to the import path of the fetch adapter:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nimport GlobalFetch from 'alova/GlobalFetch';\n\n// v3\nimport adapterFetch from 'alova/fetch';\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Changes to the import path of hooks such as useRequest/useWatcher/useFetcher:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nimport { useRequest } from 'alova';\nimport { usePagination, useForm } from '@alova/scene-[vue/react/svelte]';\n\n// v3\nimport { useRequest, usePagination, useForm } from 'alova/client';\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"The cache mode is redesigned, the placeholder mode is removed, and the initialData function can be used to achieve the same effect:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nconst { data } = useRequest(Getter, {\n  placeholder: true\n});\n\n// v3\nconst { data } = useRequest(Getter, {\n  initialData() {\n    // Set the last response data\n    const storedData = localStorage.getItem('placeholder-data');\n    return JSON.parse(storedData || '{}');\n\n    // Also use alova's storage adapter\n    // return alovaInst.l2cache.get('placeholder-data');\n  }\n}).onSuccess(({ data, method }) => {\n  // Save response data\n  localStorage.setItem('placeholder-data', JSON.stringify(data));\n\n  // Also use alova's storage adapter\n  alovaInst.l2cache.set('placeholder-data', data);\n});\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsx)(n.li,{children:"Cache operation function becomes asynchronous and supports specifying cache level:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nsetCache(methodInstance, data);\nconst cache = queryCache(methodInstance);\ninvalidateCache();\n\n// v3\nawait setCache(methodInstance, data, { policy: 'all' });\nconst cache = queryCache(methodInstance);\nawait invalidateCache(methodInstance);\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"5",children:["\n",(0,t.jsx)(n.li,{children:"Changes in the usage of method snapshot matchers:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\ninvalidateCache('method-name');\n\n// v3\nconst methodSnapshots = alovaInst.snapshots.match('method-name');\ninvalidateCache(methodSnapshots);\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"6",children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"sendable"})," option of useWatcher has been removed, use ",(0,t.jsx)(n.code,{children:"middleware"})," instead:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nuseWatcher(() => method, [xxx], { sendable: () => sendable });\n\n// v3\nuseWatcher(() => method, [xxx], {\n  async middleware(_, \u200b\u200bnext) {\n    if (sendable) {\n      return next();\n    }\n  }\n});\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"7",children:["\n",(0,t.jsxs)(n.li,{children:["method ",(0,t.jsx)(n.code,{children:"enableDownload/enableUpload"})," options are removed and changed to automatic judgment:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nalova.Get('/api/file', {\n  enableDownload: true\n});\n\n// v3\nalova.Get('/api/file');\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"8",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"responsed"})," replaces ",(0,t.jsx)(n.code,{children:"responded"})," in createAlova:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\ncreateAlova({\n  respondedd() {\n    // ...\n  }\n});\n\n// v3\ncreateAlova({\n  responded() {\n    // ...\n  }\n});\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"9",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"errorLogger"})," parameter is removed and error handling logic is changed:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\ncreateAlova({\n  errorLogger: true\n});\n\n// v3\n// No need to set, error log is automatically processed\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"10",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"updateState"})," no longer supports method Matcher, onMatch hook removed:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nupdateState('method-name', newState, {\n  onMatch: () => {}\n});\n\n// v3\nconst methodSnapshots = alovaInst.snapshots.match('method-name');\nupdateState(methodSnapshots, newState);\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"11",children:["\n",(0,t.jsx)(n.li,{children:"Changes to import getMethodKey function:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nimport { getMethodKey } from 'alova';\n\n// v3\nimport { key } from '@alova/shared/function';\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"12",children:["\n",(0,t.jsx)(n.li,{children:"context.update function and decoration function removed in middleware:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nmiddleware(({ update }) => {\n  update({ loading: true });\n});\n\n// v3\nmiddleware(({ proxyStates }) => {\n  proxyStates.loading.v = true;\n});\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"13",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"mapWatcher"})," is removed from @alova/vue-options:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nexport default {\n  watch: mapWatcher({\n    'testRequest.data'() {\n      // ...\n    }\n  });\n}\n\n// v3\nexport default {\n  watch: {\n    'testRequest.data'() {\n      // ...\n    }\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"14",children:["\n",(0,t.jsx)(n.li,{children:"Changes in how usePagination is used in React:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nconst {\n  page: [page, setPage],\n  pageSize: [pageSize, setPageSize]\n} = usePagination(/*...*/);\nsetPage(page + 1);\n\n// v3\nconst { page, pageSize, update } = usePagination(/*...*/);\nupdate({ page: page + 1 });\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"15",children:["\n",(0,t.jsx)(n.li,{children:"useForm no longer supports directly passing in id to return cached hookReturns:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nconst states = useForm('form-id');\n\n// v3\nconst { states } = useForm(formData => methodHandler(formData), {\n  id: 'form-id'\n});\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"16",children:["\n",(0,t.jsx)(n.li,{children:"SilentMethod related methods become asynchronous:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nsilentMethod.replace(newSilentMethod);\n\n// v3\nawait silentMethod.replace(newSilentMethod);\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"17",children:["\n",(0,t.jsxs)(n.li,{children:["accessAction adds ",(0,t.jsx)(n.code,{children:"silent"})," parameter, no longer throws an error when no match is found."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\naccessAction('method-name', ({ send }) => {\n  send();\n});\n\n// v3\naccessAction(\n  'method-name',\n  ({ send }) => {\n    send();\n  },\n  true\n);\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"18",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"method.__key__"})," is simplified to method.key:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nmethod.__key__ = 'custom-key';\n// v3\nmethod.key = 'custom-key ';\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"19",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"method.transformData"})," is simplified to method.transform:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nalova.Get('/api/profile', {\n  transformData(data) {\n    return data.detail;\n  }\n});\n// v3\nalova.Get('/api/profile', {\n  transform(data) {\n    return data.detail;\n  }\n});\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"20",children:["\n",(0,t.jsx)(n.li,{children:"method.localCache changed to method.cacheFor:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nalova.Get('/api/profile', {\n  localCache: 1000 * 60 * 60\n});\n\n// v3\nalova.Get('/api/profile', {\n  cacheFor: 1000 * 60 * 60\n});\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"21",children:["\n",(0,t.jsx)(n.li,{children:"All sendArgs changed to args:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nonSuccess(({ sendArgs }) => {\n  // ...\n});\n\n// v3\nonSuccess(({ args }) => {\n  // ...\n});\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"22",children:["\n",(0,t.jsx)(n.li,{children:"@alova/adapter-uniapp export name changed:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nimport { uniappStorageAdapter } from '@alova/adapter-uniapp';\n\n// v3\nimport { uniappL2CacheAdapter } from '@alova/adapter-uniapp';\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"23",children:["\n",(0,t.jsx)(n.li,{children:"Use proxyState in middleware to access and modify state:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nmiddleware(({ states, update }) => {\n  const loading = states.loading;\n  update({\n    loading: true\n  });\n});\n\n// v3\nmiddleware(({ proxyStates }) => {\n  proxyStates.loading.v = true;\n});\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"24",children:["\n",(0,t.jsx)(n.li,{children:"Event binding function returns its own object and supports chain calls:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nconst { onSuccess, loading, data } = useRequest(method);\nonSuccess(() => {\n  /*...*/\n});\n\n// v3\nconst { loading, data } = useRequest(method).onSuccess(() => {\n  /*...*/\n});\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"25",children:["\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.code,{children:"alova.snapshots.match"})," to get the visited method instance snapshot:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// v2\nconst methodSnapshots = matchSnapshotMethod('method-name');\n\n// V3\nconst methodSnapshots = alova.snapshots.match('method-name');\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},11151:(e,n,a)=>{a.d(n,{Z:()=>c,a:()=>r});var t=a(67294);const s={},o=t.createContext(s);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);