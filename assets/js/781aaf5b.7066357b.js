"use strict";(self.webpackChunkalova_website=self.webpackChunkalova_website||[]).push([[3379],{3549:(e,a,r)=>{r.r(a),r.d(a,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>u});var t=r(5893),n=r(1151),s=r(4866),o=r(5162);const i={title:"axios adapter",sidebar_position:30},l=void 0,c={id:"tutorial/request-adapter/alova-adapter-axios",title:"axios adapter",description:"Install",source:"@site/docs/tutorial/08-request-adapter/03-alova-adapter-axios.md",sourceDirName:"tutorial/08-request-adapter",slug:"/tutorial/request-adapter/alova-adapter-axios",permalink:"/tutorial/request-adapter/alova-adapter-axios",draft:!1,unlisted:!1,editUrl:"https://github.com/alovajs/alovajs.github.io/blob/main/docs/tutorial/08-request-adapter/03-alova-adapter-axios.md",tags:[],version:"current",sidebarPosition:30,frontMatter:{title:"axios adapter",sidebar_position:30},sidebar:"tutorialSidebar",previous:{title:"XMLHttpRequest Adapter",permalink:"/tutorial/request-adapter/alova-adapter-xhr"},next:{title:"Taro Adapter",permalink:"/tutorial/request-adapter/alova-adapter-taro"}},d={},u=[{value:"Install",id:"install",level:2},{value:"Instructions",id:"instructions",level:2},{value:"create alova",id:"create-alova",level:3},{value:"usage",id:"usage",level:2},{value:"request",id:"request",level:3},{value:"Upload",id:"upload",level:3},{value:"download",id:"download",level:3},{value:"Use custom axios instance",id:"use-custom-axios-instance",level:2},{value:"Mock request adapter compatible",id:"mock-request-adapter-compatible",level:2},{value:"method configuration",id:"method-configuration",level:3},{value:"Response data",id:"response-data",level:3},{value:"Error",id:"error",level:3}];function p(e){const a={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,n.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.h2,{id:"install",children:"Install"}),"\n",(0,t.jsxs)(s.Z,{children:[(0,t.jsx)(o.Z,{value:"1",label:"npm",children:(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"npm install @alova/adapter-axios --save\n"})})}),(0,t.jsx)(o.Z,{value:"2",label:"yarn",children:(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"yarn add @alova/adapter-axios\n"})})})]}),"\n",(0,t.jsx)(a.h2,{id:"instructions",children:"Instructions"}),"\n",(0,t.jsx)(a.h3,{id:"create-alova",children:"create alova"}),"\n",(0,t.jsxs)(a.p,{children:["Use ",(0,t.jsx)(a.strong,{children:"axiosRequestAdapter"})," as request adapter for alova."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-javascript",children:"import { createAlova } from 'alova';\r\nimport { axiosRequestAdapter } from '@alova/adapter-axios';\r\n\r\nconst alovaInst = createAlova({\r\n  //...\r\n  requestAdapter: axiosRequestAdapter()\r\n  //...\r\n});\n"})}),"\n",(0,t.jsx)(a.p,{children:"The adapter will use the default axios instance to make requests internally. If you set some global parameters for axios, you may need to pay attention to the following two points:"}),"\n",(0,t.jsxs)(a.ol,{children:["\n",(0,t.jsxs)(a.li,{children:["Priority is given to using the ",(0,t.jsx)(a.code,{children:"baseURL"})," and ",(0,t.jsx)(a.code,{children:"timeout"})," parameters in the axios instance, so if you set these parameters on the axios instance, you do not need to set them in ",(0,t.jsx)(a.code,{children:"createAlova"}),";"]}),"\n",(0,t.jsxs)(a.li,{children:["The ",(0,t.jsx)(a.code,{children:"beforeRequest"})," hook of the alova instance will be triggered earlier than the ",(0,t.jsx)(a.code,{children:"interceptor.request"})," of the axios instance, and the ",(0,t.jsx)(a.code,{children:"responded"})," hook of the alova will be triggered later than the ",(0,t.jsx)(a.code,{children:"interceptor.response"})," of the axios instance;"]}),"\n"]}),"\n",(0,t.jsxs)(a.blockquote,{children:["\n",(0,t.jsxs)(a.p,{children:["You can also ",(0,t.jsx)(a.a,{href:"#use-custom-axios-instance",children:"use custom axios instance"})]}),"\n"]}),"\n",(0,t.jsx)(a.h2,{id:"usage",children:"usage"}),"\n",(0,t.jsx)(a.h3,{id:"request",children:"request"}),"\n",(0,t.jsxs)(a.p,{children:["The usage of request is exactly the same as that used in the web environment. Already fully compatible with ",(0,t.jsx)(a.strong,{children:"axios"}),", you can specify ",(0,t.jsx)(a.a,{href:"https://axios-http.com/docs/req_config",children:"all configuration items"})," supported by ",(0,t.jsx)(a.code,{children:"axios"})," in ",(0,t.jsx)(a.em,{children:"config"})," of method instance creation."]}),"\n",(0,t.jsxs)(s.Z,{groupId:"framework",children:[(0,t.jsx)(o.Z,{value:"1",label:"vue composition",children:(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-html",children:"<tempate>\r\n   <div v-if=\"loading\">Loading...</div>\r\n   <div>The request data is: {{ data }}</div>\r\n</template>\r\n\r\n<script setup>\r\n   const list = () =>\r\n     alovaInst.Get('/list', {\r\n       // The set parameters will be passed to axios\r\n       paramsSerializer: params => {\r\n         return Qs.stringify(params, { arrayFormat: 'brackets' });\r\n       }\r\n     });\r\n   const { loading, data } = useRequest(list);\r\n<\/script>\n"})})}),(0,t.jsx)(o.Z,{value:"2",label:"react",children:(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-jsx",children:"const list = () =>\r\n   alovaInst.Get('/list', {\r\n     // The set parameters will be passed to axios\r\n     paramsSerializer: params => {\r\n       return Qs.stringify(params, {arrayFormat: 'brackets'})\r\n     },\r\n   });\r\n\r\nconst App = () => {\r\n   const { loading, data } = useRequest(list);\r\n\r\n   return (\r\n     { loading ? <div>Loading...</div> : null }\r\n     <div>The request data is: { JSON.stringify(data) }</div>\r\n   )\r\n};\n"})})}),(0,t.jsx)(o.Z,{value:"3",label:"svelte",children:(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-html",children:"<script>\r\n  const list = () =>\r\n    alovaInst.Get('/list', {\r\n      // The set parameters will be passed to axios\r\n      paramsSerializer: params => {\r\n        return Qs.stringify(params, { arrayFormat: 'brackets' });\r\n      }\r\n    });\r\n  const { loading, data } = useRequest(list);\r\n<\/script>\r\n\r\n{#if $loading}\r\n<div>Loading...</div>\r\n{/if}\r\n<div>The request data is: { data }</div>\n"})})})]}),"\n",(0,t.jsx)(a.h3,{id:"upload",children:"Upload"}),"\n",(0,t.jsxs)(a.p,{children:["Use ",(0,t.jsx)(a.code,{children:"FormData"})," to upload files, and this ",(0,t.jsx)(a.code,{children:"FormData"})," instance will be passed to axios, which is consistent with the usage of axios upload files."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-javascript",children:"const uploadFile = imageFile => {\r\n  const formData = new FormData();\r\n  formData.append('file', imageFile);\r\n  return alovaInst.Post('/uploadImg', formData, {\r\n    // Start upload progress\r\n    enableUpload: true\r\n  });\r\n};\r\n\r\nconst {\r\n  loading,\r\n  data,\r\n  uploading,\r\n  send: sendUpload\r\n} = useRequest(uploadFile, {\r\n  immediate: false\r\n});\r\n\r\n// Picture selection event callback\r\nconst handleImageChoose = ({ target }) => {\r\n  sendUpload(target.files[0]);\r\n};\n"})}),"\n",(0,t.jsx)(a.h3,{id:"download",children:"download"}),"\n",(0,t.jsxs)(a.p,{children:["Point the request url to the file address to download, you can also enable the download progress by setting ",(0,t.jsx)(a.code,{children:"enableDownload"})," to true."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-javascript",children:"const downloadFile = () =>\r\n  alovaInst.Get('/bigImage.jpg', {\r\n    // Start download progress\r\n    enableDownload: true,\r\n    responseType: 'blob'\r\n  });\r\n\r\nconst { loading, data, downloading, send, onSuccess } = useRequest(downloadFile, {\r\n  immediate: false\r\n});\r\nonSuccess(({ data: imageBlob }) => {\r\n  // download image\r\n  const anchor = document.createElement('a');\r\n  anchor.href = URL.createObjectURL(blob);\r\n  anchor.download = 'image.jpg';\r\n  anchor.click();\r\n  URL.revokeObjectURL(anchor.href);\r\n});\r\nconst handleImageDownload = () => {\r\n  send();\r\n};\n"})}),"\n",(0,t.jsx)(a.h2,{id:"use-custom-axios-instance",children:"Use custom axios instance"}),"\n",(0,t.jsx)(a.p,{children:"By default, this adapter will use the default axios instance for requests, but in some cases you need to use a custom created axios instance. You can do this:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-javascript",children:"const customAxios = axios.create({\r\n  // ...\r\n});\r\n\r\nconst alovaInst = createAlova({\r\n  // ...\r\n  // highlight-start\r\n  requestAdapter: axiosRequestAdapter({\r\n    axios: customAxios\r\n  })\r\n  // highlight-end\r\n});\n"})}),"\n",(0,t.jsx)(a.h2,{id:"mock-request-adapter-compatible",children:"Mock request adapter compatible"}),"\n",(0,t.jsxs)(a.p,{children:["When developing applications, we may still need to use simulated requests. Only by default, the response data of ",(0,t.jsx)(a.a,{href:"/tutorial/request-adapter/alova-mock",children:"Mock Request Adapter (@alova/mock)"})," is a ",(0,t.jsx)(a.code,{children:"Response"})," instance, which is compatible with the ",(0,t.jsx)(a.code,{children:"GlobalFetch"})," request adapter by default. When using the axios adapter, we The response data of the mock request adapter needs to be compatible with ",(0,t.jsx)(a.strong,{children:"AxiosResponse"}),", and the error instance is ",(0,t.jsx)(a.strong,{children:"AxiosError"}),", so you need to use ",(0,t.jsx)(a.code,{children:"axiosMockResponse"})," exported from the ",(0,t.jsx)(a.strong,{children:"@alova/adapter-axios"})," package as the response adapter ."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-javascript",children:"import { defineMock, createAlovaMockAdapter } from '@alova/mock';\r\nimport { axiosRequestAdapter, axiosMockResponse } from '@alova/adapter-axios';\r\n\r\nconst mocks = defineMock({\r\n  //...\r\n});\r\n\r\n// mock data request adapter\r\nexport default createAlovaMockAdapter([mocks], {\r\n  // After specifying axios request adapter, requests that do not match the simulated interface will use this adapter to send requests\r\n  httpAdapter: axiosRequestAdapter(),\r\n\r\n  // axiosMockResponse contains onMockResponse and onMockError\r\n  // Used to convert mock data to AxiosResponse and AxiosError compatible format\r\n  ...axiosMockResponse\r\n});\r\n\r\nexport const alovaInst = createAlova({\r\n  //...\r\n  // Control whether to use the simulated request adapter through environment variables\r\n  requestAdapter: process.env.NODE_ENV === 'development' ? mockAdapter : axiosRequestAdapter()\r\n});\n"})}),"\n",(0,t.jsx)(a.p,{children:"##Typescript"}),"\n",(0,t.jsx)(a.p,{children:"The axios request adapter provides complete type adaptation. The type of method configuration and response data will exactly match the type of axios."}),"\n",(0,t.jsx)(a.h3,{id:"method-configuration",children:"method configuration"}),"\n",(0,t.jsxs)(a.p,{children:["When creating a method instance, in addition to the general configuration items in the method, you can also use the configuration items in ",(0,t.jsx)(a.code,{children:"AxiosRequestConfig"}),", we have removed the items that conflict with the general configuration of the method instance in the type."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-typescript",children:"/**\r\n * axios request configuration parameters\r\n * Removed the attributes that conflicted with the method\r\n */\r\nexport type AlovaAxiosRequestConfig = Omit<\r\n  AxiosRequestConfig,\r\n  | 'url'\r\n  | 'method'\r\n  | 'baseURL'\r\n  | 'headers'\r\n  | 'params'\r\n  | 'data'\r\n  | 'timeout'\r\n  | 'cancelToken'\r\n  | 'signal'\r\n  | 'onUploadProgress'\r\n  | 'onDownloadProgress'\r\n>;\n"})}),"\n",(0,t.jsx)(a.h3,{id:"response-data",children:"Response data"}),"\n",(0,t.jsxs)(a.p,{children:["The response data type of axios is ",(0,t.jsx)(a.code,{children:"AxiosResponse"}),", when you use the axios adapter, you will also get the response data in the same format. In actual use, we usually need to process response data globally. A simple example is as follows:"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-typescript",children:"const alovaInst = createAlova(\r\n   baseURL: 'https://api.alovajs.org',\r\n   requestAdapter: axiosRequestAdapter(),\r\n   responded(response) {\r\n     // response is automatically inferred as AxiosResponse type\r\n     return response.data;\r\n   }\r\n});\n"})}),"\n",(0,t.jsx)(a.h3,{id:"error",children:"Error"}),"\n",(0,t.jsxs)(a.p,{children:["When axios receives non-20x and 30x response status codes, it will throw an error. In order to contain more information, axios custom-designed the error instance into an ",(0,t.jsx)(a.code,{children:"AxiosError"})," instance instead of a normal Error instance, so when encountering An error will be thrown when there is a server error or a network error, and you can catch it in the global error callback."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-typescript",children:"const alovaInst = createAlova(\r\n   baseURL: 'https://api.alovajs.org',\r\n   requestAdapter: axiosRequestAdapter(),\r\n   responded: {\r\n     onSuccess(response) {\r\n       // response is automatically inferred as AxiosResponse type\r\n       return response.data;\r\n     },\r\n     onError(err: AxiosError) {\r\n       // err type is any by default, you can cast it to AxiosError\r\n       //...\r\n     }\r\n   }\r\n});\n"})})]})}function h(e={}){const{wrapper:a}={...(0,n.a)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},5162:(e,a,r)=>{r.d(a,{Z:()=>o});r(7294);var t=r(512);const n={tabItem:"tabItem_Ymn6"};var s=r(5893);function o(e){let{children:a,hidden:r,className:o}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,t.Z)(n.tabItem,o),hidden:r,children:a})}},4866:(e,a,r)=>{r.d(a,{Z:()=>w});var t=r(7294),n=r(512),s=r(2466),o=r(6550),i=r(469),l=r(1980),c=r(7392),d=r(12);function u(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:a}=e;return!!a&&"object"==typeof a&&"value"in a}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:a,children:r}=e;return(0,t.useMemo)((()=>{const e=a??function(e){return u(e).map((e=>{let{props:{value:a,label:r,attributes:t,default:n}}=e;return{value:a,label:r,attributes:t,default:n}}))}(r);return function(e){const a=(0,c.l)(e,((e,a)=>e.value===a.value));if(a.length>0)throw new Error(`Docusaurus error: Duplicate values "${a.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[a,r])}function h(e){let{value:a,tabValues:r}=e;return r.some((e=>e.value===a))}function m(e){let{queryString:a=!1,groupId:r}=e;const n=(0,o.k6)(),s=function(e){let{queryString:a=!1,groupId:r}=e;if("string"==typeof a)return a;if(!1===a)return null;if(!0===a&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:a,groupId:r});return[(0,l._X)(s),(0,t.useCallback)((e=>{if(!s)return;const a=new URLSearchParams(n.location.search);a.set(s,e),n.replace({...n.location,search:a.toString()})}),[s,n])]}function x(e){const{defaultValue:a,queryString:r=!1,groupId:n}=e,s=p(e),[o,l]=(0,t.useState)((()=>function(e){let{defaultValue:a,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!h({value:a,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${a}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return a}const t=r.find((e=>e.default))??r[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:a,tabValues:s}))),[c,u]=m({queryString:r,groupId:n}),[x,v]=function(e){let{groupId:a}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(a),[n,s]=(0,d.Nk)(r);return[n,(0,t.useCallback)((e=>{r&&s.set(e)}),[r,s])]}({groupId:n}),f=(()=>{const e=c??x;return h({value:e,tabValues:s})?e:null})();(0,i.Z)((()=>{f&&l(f)}),[f]);return{selectedValue:o,selectValue:(0,t.useCallback)((e=>{if(!h({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),v(e)}),[u,v,s]),tabValues:s}}var v=r(2389);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=r(5893);function b(e){let{className:a,block:r,selectedValue:t,selectValue:o,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.o5)(),d=e=>{const a=e.currentTarget,r=l.indexOf(a),n=i[r].value;n!==t&&(c(a),o(n))},u=e=>{let a=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const r=l.indexOf(e.currentTarget)+1;a=l[r]??l[0];break}case"ArrowLeft":{const r=l.indexOf(e.currentTarget)-1;a=l[r]??l[l.length-1];break}}a?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,n.Z)("tabs",{"tabs--block":r},a),children:i.map((e=>{let{value:a,label:r,attributes:s}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:t===a?0:-1,"aria-selected":t===a,ref:e=>l.push(e),onKeyDown:u,onClick:d,...s,className:(0,n.Z)("tabs__item",f.tabItem,s?.className,{"tabs__item--active":t===a}),children:r??a},a)}))})}function j(e){let{lazy:a,children:r,selectedValue:n}=e;const s=(Array.isArray(r)?r:[r]).filter(Boolean);if(a){const e=s.find((e=>e.props.value===n));return e?(0,t.cloneElement)(e,{className:"margin-top--md"}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:s.map(((e,a)=>(0,t.cloneElement)(e,{key:a,hidden:e.props.value!==n})))})}function y(e){const a=x(e);return(0,g.jsxs)("div",{className:(0,n.Z)("tabs-container",f.tabList),children:[(0,g.jsx)(b,{...e,...a}),(0,g.jsx)(j,{...e,...a})]})}function w(e){const a=(0,v.Z)();return(0,g.jsx)(y,{...e,children:u(e.children)},String(a))}},1151:(e,a,r)=>{r.d(a,{Z:()=>i,a:()=>o});var t=r(7294);const n={},s=t.createContext(n);function o(e){const a=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),t.createElement(s.Provider,{value:a},e.children)}}}]);