"use strict";(self.webpackChunkalova_website=self.webpackChunkalova_website||[]).push([[3464],{75438:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>d,default:()=>c,frontMatter:()=>s,metadata:()=>o,toc:()=>r});var n=i(85893),a=i(11151);const s={title:"Step 5 - Edit Data"},d=void 0,o={id:"tutorial/strategy/seamless-data-interaction/edit-item",title:"Step 5 - Edit Data",description:"What should I do when the user needs to edit data when the network is disconnected?",source:"@site/versioned_docs/version-v2/tutorial/05-strategy/01-seamless-data-interaction/08-edit-item.md",sourceDirName:"tutorial/05-strategy/01-seamless-data-interaction",slug:"/tutorial/strategy/seamless-data-interaction/edit-item",permalink:"/v2/tutorial/strategy/seamless-data-interaction/edit-item",draft:!1,unlisted:!1,editUrl:"https://github.com/alovajs/alovajs.github.io/blob/main/versioned_docs/version-v2/tutorial/05-strategy/01-seamless-data-interaction/08-edit-item.md",tags:[],version:"v2",sidebarPosition:8,frontMatter:{title:"Step 5 - Edit Data"},sidebar:"tutorial",previous:{title:"Step 4 - Data Compensation",permalink:"/v2/tutorial/strategy/seamless-data-interaction/data-compensation"},next:{title:"What more?",permalink:"/v2/tutorial/strategy/seamless-data-interaction/what-more"}},l={},r=[{value:"Edit silent submit items",id:"edit-silent-submit-items",level:2},{value:"When the data item being edited is submitted successfully",id:"when-the-data-item-being-edited-is-submitted-successfully",level:2}];function h(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:"What should I do when the user needs to edit data when the network is disconnected?"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"At this point, two situations need to be explained:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"The list data can meet the data echo of the edit page. At this time, the list data can be passed to the edit page without requesting. At this time, all list data supports editing in the silent submission mode;"}),"\n",(0,n.jsxs)(t.li,{children:["The echo data on the edit page needs to be obtained through the api, and only the locally cached list items can echo the data normally, for example:","\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"For the list items that have been accessed before the network is disconnected, the request can hit the cache again;"}),"\n",(0,n.jsx)(t.li,{children:"Created through the silent submission mode, but the list item has not been successfully submitted, and the submitted data still exists in the silentMethod instance;"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["And here we will focus on the case of ",(0,n.jsx)(t.strong,{children:"2-2"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"edit-silent-submit-items",children:"Edit silent submit items"}),"\n",(0,n.jsxs)(t.p,{children:["In the previous chapters, we know that when the newly created data item has not been successfully submitted, the virtual data will be used as the placeholder for the id. Usually, we also get the data item through the id. At this time, we are in ",(0,n.jsx)(t.code,{children:"useSQRequeset"})," Virtual data interception is implemented on the above, if a request is accompanied by virtual data information, it will be intercepted before sending and the data can be specified to replace the response data, and the request will be abandoned."]}),"\n",(0,n.jsxs)(t.p,{children:["Remember the ",(0,n.jsx)(t.strong,{children:"silentMethod.reviewData"})," saved in ",(0,n.jsx)(t.a,{href:"/v2/tutorial/strategy/seamless-data-interaction/modify-response",children:"Step 2 - Adjust Response Handling"}),"?"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"onSuccess(({ silentMethod }) => {\n  // Construct list data items\n  const editingItem = {\n    ...detail,\n    id: id || data.id\n  };\n  //...\n  if (silentMethod) {\n    // highlight-start\n    // Setting the name is to find the corresponding silentMethod instance when intercepting\n    silentMethod.entity.setName('edit' + editingItem.id);\n    silentMethod.reviewData = {\n      operate: id ? 'edit' : 'add',\n      data: editingItem\n    };\n    // Don't forget to call save\n    silentMethod.save();\n    // highlight-end\n  }\n});\n"})}),"\n",(0,n.jsx)(t.p,{children:"It can be used not only for data compensation, but also for echoing data in edit pages."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"const { loading, data } = useSQRequest(id => todoDetail(id), {\n  initialData: {\n    title: '',\n    time: new Date()\n  },\n  immediate: false,\n\n  // highlight-start\n  // Set the interception function, the function will be called when there is virtual data in this request\n  // If reviewData is returned, it will replace the response data and give up this request, otherwise the request will still be initiated\n  vDataCaptured: () => {\n    const targetSM = filterSilentMethods('edit' + todoId).pop();\n    if (targetSM?.reviewData) {\n      return { ...targetSM.reviewData.data };\n    }\n  }\n  // highlight-end\n});\n"})}),"\n",(0,n.jsx)(t.admonition,{title:"Caution",type:"warning",children:(0,n.jsxs)(t.p,{children:["You can save enough data in ",(0,n.jsx)(t.strong,{children:"silentMethod.reviewData"})," to satisfy both list data compensation and edit page data echo."]})}),"\n",(0,n.jsx)(t.p,{children:"So far, data items created through silent submit mode also support editing! What's the problem, um... and one last one."}),"\n",(0,n.jsx)(t.h2,{id:"when-the-data-item-being-edited-is-submitted-successfully",children:"When the data item being edited is submitted successfully"}),"\n",(0,n.jsx)(t.p,{children:"When the user is editing a data item that has not been successfully submitted, it suddenly submits successfully! At this time, we need to replace the virtual data used in the edit page with actual data, for example, replace the virtual id with the actual id, and use the actual id to submit in the next edit. This is also very simple, we only need to monitor This is done by silently submitting the success event, which will receive a data collection consisting of virtual data and real data."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"import { onSilentSubmitSuccess, stringifyVData } from '@alova/scene-*';\n\n//...\n// id is virtual data during initialization\nlet id = /* todo virtual id */;\n\n// highlight-start\n// Binding listener silently submits the successful event to update the id, and returns the unbind function, don't forget to call the unbind function when the component is destroyed\nconst unbindEvent = onSilentSubmitSuccess(event => {\n   const vDataId = stringifyVData(id);\n   if (event.vDataResponse[vDataId]) {\n     id = event.vDataResponse[vDataId];\n\n     // The following is to change the virtual id in the url to the actual id\n     history.replaceState(null, '', '?id=' + currentId);\n   }\n});\n// highlight-end\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Here, the ",(0,n.jsx)(t.code,{children:"event.vDataResponse"})," value is a collection of virtual data id and actual data, and its format is as follows:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"{\n   '[vd:aaaaaa]': { id: 1 },\n   '[vd:bbbbbb]': 1\n}\n"})}),"\n",(0,n.jsx)(t.p,{children:"So far, we have completed all the content of a simple list of non-inductive interaction, but in other application scenarios such as editing applications, complex list management, etc., we may encounter more different needs. What else does alova have at this time? What are the features we can use? Please read the next chapter!"})]})}function c(e={}){const{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},11151:(e,t,i)=>{i.d(t,{Z:()=>o,a:()=>d});var n=i(67294);const a={},s=n.createContext(a);function d(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);