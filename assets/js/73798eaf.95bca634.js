"use strict";(self.webpackChunkalova_website=self.webpackChunkalova_website||[]).push([[3057],{2289:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>p,frontMatter:()=>l,metadata:()=>c,toc:()=>d});var n=r(5893),s=r(1151),a=r(4866),o=r(5162);const l={title:"response processing",sidebar_position:80},i=void 0,c={id:"tutorial/getting-started/response",title:"response processing",description:"After the request is completed, the response data will be processed through multiple processes before the final data is obtained at the location where the request was sent. The process is as follows:",source:"@site/docs/tutorial/02-getting-started/08-response.md",sourceDirName:"tutorial/02-getting-started",slug:"/tutorial/getting-started/response",permalink:"/tutorial/getting-started/response",draft:!1,unlisted:!1,editUrl:"https://github.com/alovajs/alovajs.github.io/blob/main/docs/tutorial/02-getting-started/08-response.md",tags:[],version:"current",sidebarPosition:80,frontMatter:{title:"response processing",sidebar_position:80},sidebar:"tutorialSidebar",previous:{title:"Set initial data",permalink:"/tutorial/getting-started/initial-data"},next:{title:"Request manually",permalink:"/tutorial/getting-started/request-manually"}},u={},d=[{value:"Transform response data",id:"transform-response-data",level:2},{value:"Binding response callback",id:"binding-response-callback",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",mermaid:"mermaid",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"After the request is completed, the response data will be processed through multiple processes before the final data is obtained at the location where the request was sent. The process is as follows:"}),"\n",(0,n.jsx)(t.mermaid,{value:"flowchart LR\r\n   classDef condition fill:#a8bcff\r\n\r\n   R1[Response successful] --\x3e alovaInstance.responded.onSuccess\r\n   alovaInstance.responded.onSuccess --\x3e throw{throw error?}:::condition\r\n   throw --\x3e|No| method.transformData\r\n   method.transformData --\x3e useRequest.onSuccess\r\n   throw --\x3e|Yes| useRequest.onError\r\n\r\n   method.transformData --\x3e throw2{throw error?}:::condition\r\n   throw2 --\x3e|No| useRequest.onSuccess\r\n   throw2 --\x3e|Yes| useRequest.onError\r\n\r\n   useRequest.onSuccess --\x3e throw3{throw error?}:::condition\r\n   throw3 --\x3e|Yes| useRequest.onError\r\n\r\n   R2[Response error] --\x3e alovaInstance.responded.onError\r\n   alovaInstance.responded.onError --\x3e throw4{throw error?}:::condition\r\n   throw4 --\x3e|Yes| useRequest.onError\r\n   throw4 --\x3e|No| method.transformData"}),"\n",(0,n.jsxs)(t.p,{children:["When no error is thrown, the next node will receive the return value of the previous node. The global response interceptor has been explained in ",(0,n.jsx)(t.a,{href:"/tutorial/getting-started/global-interceptor",children:"Global Interceptor"}),". Next, let's take a look at ",(0,n.jsx)(t.code,{children:"transformData"})," in method."]}),"\n",(0,n.jsx)(t.h2,{id:"transform-response-data",children:"Transform response data"}),"\n",(0,n.jsxs)(t.p,{children:["When the response data structure of a request cannot directly meet the usage needs, we can set the ",(0,n.jsx)(t.code,{children:"transformData"})," for the method instance to transform response data into the required structure."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"const todoListGetter = alovaInstance.Get('/todo/list', {\r\n  params: {\r\n    page: 1\r\n  },\r\n\r\n  // The function accepts raw data and response headers, and requires the transformed data to be returned, which will be assigned to the data state.\r\n  // Note: rawData is the data filtered by the global response interceptor (if it is set). For the configuration of the response interceptor, please refer to the [Setting the Global Response Interceptor] chapter.\r\n  transformData(rawData, headers) {\r\n    return rawData.list.map(item => {\r\n      return {\r\n        ...item,\r\n        statusText: item.done ? 'Completed' : 'In progress'\r\n      };\r\n    });\r\n  }\r\n});\n"})}),"\n",(0,n.jsxs)(a.Z,{children:[(0,n.jsx)(o.Z,{value:"1",label:"useRequest",children:(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"const { data } = useRequest(todoListGetter);\n"})})}),(0,n.jsx)(o.Z,{value:"2",label:"method",children:(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"const data = await todoListGetter;\n"})})})]}),"\n",(0,n.jsx)(t.p,{children:"The data value will receive the transformed data structure."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:"type data = {\r\n  // ...\r\n  statusText: 'Completed' | 'In progress';\r\n}[];\n"})}),"\n",(0,n.jsx)(t.admonition,{title:"note",type:"warning",children:(0,n.jsxs)(t.p,{children:["When used in usehooks, throwing an error in ",(0,n.jsx)(t.code,{children:"transformData"})," will also trigger ",(0,n.jsx)(t.code,{children:"onError"}),";"]})}),"\n",(0,n.jsx)(t.h2,{id:"binding-response-callback",children:"Binding response callback"}),"\n",(0,n.jsx)(t.p,{children:"If you need to set a request callback, you can also receive the callback setting function in the return parameter of useRequest, as follows:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"const {\r\n  // ...\r\n\r\n  //Successful callback binding\r\n  onSuccess,\r\n\r\n  // Failure callback binding\r\n  onError,\r\n\r\n  // Complete the callback binding, the callback will be called on success or failure\r\n  onComplete\r\n} = useRequest(todoListGetter);\r\nonSuccess(event => {\r\n  console.log('The request was successful, the response data is:', event.data);\r\n  console.log('The method instance of this request is:', event.method);\r\n  console.log('Whether the response data comes from the cache:', event.fromCache);\r\n});\r\nonError(event => {\r\n  console.log('The request failed, the error message is:', event.error);\r\n  console.log('The method instance of this request is:', event.method);\r\n});\r\nonComplete(event => {\r\n  // event.status is success when it succeeds and error when it fails.\r\n  console.log('The request is completed, the status is: ', event.status);\r\n  console.log('The method instance of this request is:', event.method);\r\n  console.log('Whether the response data comes from the cache:', event.fromCache);\r\n  if (event.data) {\r\n    console.log('Request data:', event.data);\r\n  } else if (event.error) {\r\n    console.log('Error message:', event.error);\r\n  }\r\n});\n"})}),"\n",(0,n.jsx)(t.admonition,{title:"note",type:"warning",children:(0,n.jsxs)(t.p,{children:["Throwing an error in ",(0,n.jsx)(t.code,{children:"onSuccess"})," will trigger ",(0,n.jsx)(t.code,{children:"onError"}),"."]})})]})}function p(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},5162:(e,t,r)=>{r.d(t,{Z:()=>o});r(7294);var n=r(4334);const s={tabItem:"tabItem_Ymn6"};var a=r(5893);function o(e){let{children:t,hidden:r,className:o}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,n.Z)(s.tabItem,o),hidden:r,children:t})}},4866:(e,t,r)=>{r.d(t,{Z:()=>q});var n=r(7294),s=r(4334),a=r(2466),o=r(6550),l=r(469),i=r(1980),c=r(7392),u=r(12);function d(e){return n.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:r}=e;return(0,n.useMemo)((()=>{const e=t??function(e){return d(e).map((e=>{let{props:{value:t,label:r,attributes:n,default:s}}=e;return{value:t,label:r,attributes:n,default:s}}))}(r);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,r])}function p(e){let{value:t,tabValues:r}=e;return r.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:r}=e;const s=(0,o.k6)(),a=function(e){let{queryString:t=!1,groupId:r}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:t,groupId:r});return[(0,i._X)(a),(0,n.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(s.location.search);t.set(a,e),s.replace({...s.location,search:t.toString()})}),[a,s])]}function f(e){const{defaultValue:t,queryString:r=!1,groupId:s}=e,a=h(e),[o,i]=(0,n.useState)((()=>function(e){let{defaultValue:t,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=r.find((e=>e.default))??r[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:a}))),[c,d]=m({queryString:r,groupId:s}),[f,b]=function(e){let{groupId:t}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(t),[s,a]=(0,u.Nk)(r);return[s,(0,n.useCallback)((e=>{r&&a.set(e)}),[r,a])]}({groupId:s}),g=(()=>{const e=c??f;return p({value:e,tabValues:a})?e:null})();(0,l.Z)((()=>{g&&i(g)}),[g]);return{selectedValue:o,selectValue:(0,n.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);i(e),d(e),b(e)}),[d,b,a]),tabValues:a}}var b=r(2389);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var v=r(5893);function x(e){let{className:t,block:r,selectedValue:n,selectValue:o,tabValues:l}=e;const i=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.o5)(),u=e=>{const t=e.currentTarget,r=i.indexOf(t),s=l[r].value;s!==n&&(c(t),o(s))},d=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const r=i.indexOf(e.currentTarget)+1;t=i[r]??i[0];break}case"ArrowLeft":{const r=i.indexOf(e.currentTarget)-1;t=i[r]??i[i.length-1];break}}t?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":r},t),children:l.map((e=>{let{value:t,label:r,attributes:a}=e;return(0,v.jsx)("li",{role:"tab",tabIndex:n===t?0:-1,"aria-selected":n===t,ref:e=>i.push(e),onKeyDown:d,onClick:u,...a,className:(0,s.Z)("tabs__item",g.tabItem,a?.className,{"tabs__item--active":n===t}),children:r??t},t)}))})}function w(e){let{lazy:t,children:r,selectedValue:s}=e;const a=(Array.isArray(r)?r:[r]).filter(Boolean);if(t){const e=a.find((e=>e.props.value===s));return e?(0,n.cloneElement)(e,{className:"margin-top--md"}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:a.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==s})))})}function j(e){const t=f(e);return(0,v.jsxs)("div",{className:(0,s.Z)("tabs-container",g.tabList),children:[(0,v.jsx)(x,{...e,...t}),(0,v.jsx)(w,{...e,...t})]})}function q(e){const t=(0,b.Z)();return(0,v.jsx)(j,{...e,children:d(e.children)},String(t))}},1151:(e,t,r)=>{r.d(t,{Z:()=>l,a:()=>o});var n=r(7294);const s={},a=n.createContext(s);function o(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);