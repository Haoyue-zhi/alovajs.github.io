"use strict";(self.webpackChunkalova_website=self.webpackChunkalova_website||[]).push([[1758],{14196:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>c,default:()=>f,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var a=n(85893),r=n(11151),s=n(74866),o=n(85162);const i={title:"Fetch Data"},c=void 0,l={id:"tutorial/client/strategy/use-fetcher",title:"Fetch Data",description:"use hook",source:"@site/docs/tutorial/03-client/01-strategy/03-use-fetcher.md",sourceDirName:"tutorial/03-client/01-strategy",slug:"/tutorial/client/strategy/use-fetcher",permalink:"/tutorial/client/strategy/use-fetcher",draft:!1,unlisted:!1,editUrl:"https://github.com/alovajs/alovajs.github.io/blob/main/docs/tutorial/03-client/01-strategy/03-use-fetcher.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Fetch Data"},sidebar:"tutorial",previous:{title:"Watching Request",permalink:"/tutorial/client/strategy/use-watcher"},next:{title:"Pagination request strategy",permalink:"/tutorial/client/strategy/use-pagination"}},u={},d=[{value:"Preload data",id:"preload-data",level:2},{value:"Update views across modules/components",id:"update-views-across-modulescomponents",level:2},{value:"Force sending request",id:"force-sending-request",level:2}];function h(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.admonition,{title:"request strategy",type:"info",children:(0,a.jsx)(t.p,{children:"use hook"})}),"\n",(0,a.jsx)(t.p,{children:"When you have the following needs:"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsx)(t.li,{children:"Preload the data that will be used in subsequent processes and store it in the cache, so that users no longer have to wait for the data loading process;"}),"\n",(0,a.jsx)(t.li,{children:"Conveniently implement cross-page data update (similar to global state), for example, modify an item in the todo list and then re-fetch the latest data, and the interface will be refreshed after the response."}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"useFetcher"})," is the hook used to implement the above scenario. The response data obtained through it cannot be received directly, but the data fetched through it will not only update the cache, but also update the corresponding state, thereby re-rendering the view."]}),"\n",(0,a.jsx)(t.h2,{id:"preload-data",children:"Preload data"}),"\n",(0,a.jsx)(t.p,{children:"Let's implement a paging list to automatically preload the next page of data. Before preloading data, please make sure that the Method instance used has enabled caching."}),"\n",(0,a.jsxs)(s.Z,{groupId:"framework",children:[(0,a.jsx)(o.Z,{value:"1",label:"vue",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-html",children:"<template>\n  <div v-if=\"loading\">Fetching...</div>\n  \x3c!-- List view --\x3e\n</template>\n\n<script setup>\n  import { useFetcher } from 'alova/client';\n\n  //method instance creation function\n  const getTodoList = currentPage => {\n    return alovaInstance.Get('/todo/list', {\n      cacheFor: 60000,\n      params: {\n        currentPage,\n        pageSize: 10\n      }\n    });\n  };\n\n  const {\n    // the loading is the status of data fetching\n    loading,\n    error,\n    onSuccess,\n    onError,\n    onComplete,\n\n    // Only after calling fetch will a request be sent to fetch data. You can call fetch repeatedly to fetch data from different interfaces.\n    fetch\n  } = useFetcher({\n    updateState: false\n  });\n\n  const currentPage = ref(1);\n  const { data } = useWatcher(() => getTodoList(currentPage.value), [currentPage], {\n    immediate: true\n  }).onSuccess(() => {\n    // After the current page is loaded successfully, pass in the method instance of the next page to pre-fetch the data of the next page.\n    fetch(getTodoList(currentPage.value + 1));\n  });\n<\/script>\n"})})}),(0,a.jsx)(o.Z,{value:"2",label:"react",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-jsx",children:"import { useState } from 'react';\nimport { useFetcher } from 'alova/client';\n\n//method instance creation function\nconst getTodoList = currentPage => {\n  return alovaInstance.Get('/todo/list', {\n    cacheFor: 60000,\n    params: {\n      currentPage,\n      pageSize: 10\n    }\n  });\n};\n\nconst App = () => {\n  const {\n    // the loading is the status of data fetching\n    loading,\n    error,\n    onSuccess,\n    onError,\n    onComplete,\n\n    // Only after calling fetch will a request be sent to fetch data. You can call fetch repeatedly to fetch data from different interfaces.\n    fetch\n  } = useFetcher({\n    updateState: false\n  });\n  const [currentPage, setCurrentPage] = useState(1);\n  const { data, onSuccess } = useWatcher(() => getTodoList(currentPage), [currentPage], {\n    immediate: true\n  }).onSuccess(() => {\n    // After the current page is loaded successfully, pass in the method instance of the next page to pre-fetch the data of the next page.\n    fetch(getTodoList(currentPage + 1));\n  });\n\n  return (\n    <>\n      {loading ? <div>Fetching...</div> : null}\n      {/* list view */}\n    </>\n  );\n};\n"})})}),(0,a.jsx)(o.Z,{value:"3",label:"svelte",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-html",children:"<script>\n  import { writable } from 'svelte/store';\n  import { useFetcher } from 'alova/client';\n\n  //method instance creation function\n  const getTodoList = currentPage => {\n    return alovaInstance.Get('/todo/list', {\n      cacheFor: 60000,\n      params: {\n        currentPage,\n        pageSize: 10\n      }\n    });\n  };\n\n  const {\n    // the loading is the status of data fetching\n    loading,\n    error,\n    onSuccess,\n    onError,\n    onComplete,\n\n    // Only after calling fetch will a request be sent to fetch data. You can call fetch repeatedly to fetch data from different interfaces.\n    fetch\n  } = useFetcher({\n    updateState: false\n  });\n  const currentPage = writable(1);\n  const { data, onSuccess } = useWatcher(() => getTodoList($currentPage), [currentPage], {\n    immediate: true\n  }).onSuccess(() => {\n    // After the current page is loaded successfully, pass in the method instance of the next page to pre-fetch the data of the next page.\n    fetch(getTodoList($currentPage + 1));\n  });\n<\/script>\n\n{#if loading}\n<div>Fetching...</div>\n{/if}\n\x3c!-- List view --\x3e\n"})})}),(0,a.jsx)(o.Z,{value:"4",label:"solid",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-jsx",children:"import { createSignal } from 'solid-js';\nimport { useFetcher } from 'alova/client';\n\n// method instance creation function\nconst getTodoList = currentPage => {\n  return alovaInstance.Get('/todo/list', {\n    cacheFor: 60000,\n    params: {\n      currentPage,\n      pageSize: 10\n    }\n  });\n};\n\nconst App = () => {\n  const {\n    // loading indicates the status of sending a pull request\n    loading,\n    error,\n    onSuccess,\n    onError,\n    onComplete,\n\n    // Only after calling fetch will a request be sent to pull data. You can call fetch repeatedly to pull data from different interfaces\n    fetch\n  } = useFetcher({\n    updateState: false\n  });\n  const [currentPage, setCurrentPage] = createSignal(1);\n  const { data } = useWatcher(() => getTodoList(currentPage()), [currentPage], {\n    immediate: true\n  }).onSuccess(() => {\n    // After the current page is loaded successfully, pass the method instance of the next page to pre-fetch the data of the next page\n    fetch(getTodoList(currentPage() + 1));\n  });\n\n  return (\n    <>\n      {loading() ? <div>Fetching...</div> : null}\n      {/* List view */}\n    </>\n  );\n};\n"})})})]}),"\n",(0,a.jsx)(t.admonition,{type:"warning",children:(0,a.jsxs)(t.p,{children:["The above example is set ",(0,a.jsx)(t.code,{children:"updateState"})," to false when calling ",(0,a.jsx)(t.code,{children:"useFetcher"}),". This is because the data fetching will automatically trigger a states cross-component updating by default, causing the view to be re-rendered. When preload data is the same as the currently requested data. You can set it to false to avoid affecting view errors."]})}),"\n",(0,a.jsx)(t.h2,{id:"update-views-across-modulescomponents",children:"Update views across modules/components"}),"\n",(0,a.jsxs)(t.p,{children:["Next, we will modify a todo data and re-fetch the latest todo list data to update the view. We may not know which page the todo list is currently on. In this case, when using the ",(0,a.jsx)(t.code,{children:"fetch"})," function, we can use ",(0,a.jsx)(t.a,{href:"/tutorial/client/in-depth/method-matcher",children:"Method snapshots matcher"})," to dynamically fetch the data of the current page."]}),"\n",(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsx)(t.p,{children:"The Method snapshots matcher is used to find method instances that meet the conditions among the requested method instances."}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"First, set a name for the method instance in the todo list, which is used to filter out the required Method instance when the Method instance cannot be specified directly."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",metastring:'title="api/todoList.js"',children:"const getTodoList = currentPage => {\n  return alovaInstance.Get('/todo/list', {\n    // highlight-start\n    name: 'todoList',\n    // highlight-end\n    params: {\n      currentPage,\n      pageSize: 10\n    }\n  });\n};\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Then in the ",(0,a.jsx)(t.code,{children:"EditTodo"})," component, use the ",(0,a.jsx)(t.code,{children:"fetch"})," function to dynamically find the last name of ",(0,a.jsx)(t.code,{children:"todoList"})," in the requested Method instance to fetch data."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",metastring:'title="EditTodo Component"',children:"const { fetch } = useFetcher();\n\n// Trigger data fetch in event\nconst handleSubmit = () => {\n   // submit data...\n   // highlight-start\n  const lastMethod = alovaInstance.snapshots.match({\n    name: 'todoList',\n    filter: (method, index, ary) => {\n      // Return true to specify the Method instance that needs to be fetched\n      return index === ary.length - 1;\n    }\n  }, true);\n  if (lastMethod) {\n    await fetch(lastMethod);\n  }\n  // highlight-end\n};\n"})}),"\n",(0,a.jsx)(t.admonition,{title:"Notes",type:"warning",children:(0,a.jsxs)(t.p,{children:["useFetcher only updates the cache after the request is completed, and if this Method is foundIf the instance has been requested using useHook before, the ",(0,a.jsx)(t.code,{children:"data"})," state created by this useHook will also be updated to ensure that the page data is consistent. This is the guarantee that ",(0,a.jsx)(t.code,{children:"useFetcher"})," is used to update views across modules/components."]})}),"\n",(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsxs)(t.p,{children:["For more methods of using ",(0,a.jsx)(t.code,{children:"Method"})," instance matcher, see ",(0,a.jsx)(t.a,{href:"/tutorial/client/in-depth/method-matcher",children:"Method instance matcher"}),"."]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"force-sending-request",children:"Force sending request"}),"\n",(0,a.jsxs)(t.p,{children:["Same as ",(0,a.jsx)(t.code,{children:"useRequest"})," and ",(0,a.jsx)(t.code,{children:"useWatcher"}),", please read ",(0,a.jsx)(t.a,{href:"/tutorial/cache/force-request",children:"Force Request"})," for more information."]})]})}function f(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},85162:(e,t,n)=>{n.d(t,{Z:()=>o});n(67294);var a=n(90512);const r={tabItem:"tabItem_Ymn6"};var s=n(85893);function o(e){let{children:t,hidden:n,className:o}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,a.Z)(r.tabItem,o),hidden:n,children:t})}},74866:(e,t,n)=>{n.d(t,{Z:()=>w});var a=n(67294),r=n(90512),s=n(12466),o=n(16550),i=n(20469),c=n(91980),l=n(67392),u=n(20812);function d(e){return a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=t??function(e){return d(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}(n);return function(e){const t=(0,l.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function f(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function p(e){let{queryString:t=!1,groupId:n}=e;const r=(0,o.k6)(),s=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,c._X)(s),(0,a.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(r.location.search);t.set(s,e),r.replace({...r.location,search:t.toString()})}),[s,r])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,s=h(e),[o,c]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!f({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:s}))),[l,d]=p({queryString:n,groupId:r}),[g,m]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,s]=(0,u.Nk)(n);return[r,(0,a.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:r}),v=(()=>{const e=l??g;return f({value:e,tabValues:s})?e:null})();(0,i.Z)((()=>{v&&c(v)}),[v]);return{selectedValue:o,selectValue:(0,a.useCallback)((e=>{if(!f({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);c(e),d(e),m(e)}),[d,m,s]),tabValues:s}}var m=n(72389);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=n(85893);function x(e){let{className:t,block:n,selectedValue:a,selectValue:o,tabValues:i}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,s.o5)(),u=e=>{const t=e.currentTarget,n=c.indexOf(t),r=i[n].value;r!==a&&(l(t),o(r))},d=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":n},t),children:i.map((e=>{let{value:t,label:n,attributes:s}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:a===t?0:-1,"aria-selected":a===t,ref:e=>c.push(e),onKeyDown:d,onClick:u,...s,className:(0,r.Z)("tabs__item",v.tabItem,s?.className,{"tabs__item--active":a===t}),children:n??t},t)}))})}function j(e){let{lazy:t,children:n,selectedValue:r}=e;const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=s.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:s.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==r})))})}function y(e){const t=g(e);return(0,b.jsxs)("div",{className:(0,r.Z)("tabs-container",v.tabList),children:[(0,b.jsx)(x,{...t,...e}),(0,b.jsx)(j,{...t,...e})]})}function w(e){const t=(0,m.Z)();return(0,b.jsx)(y,{...e,children:d(e.children)},String(t))}},11151:(e,t,n)=>{n.d(t,{Z:()=>i,a:()=>o});var a=n(67294);const r={},s=a.createContext(r);function o(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);