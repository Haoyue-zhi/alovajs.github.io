"use strict";(self.webpackChunkalova_website=self.webpackChunkalova_website||[]).push([[6387],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),i=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=i(e.components);return r.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=i(n),h=a,m=c["".concat(p,".").concat(h)]||c[h]||d[h]||o;return n?r.createElement(m,s(s({ref:t},u),{},{components:n})):r.createElement(m,s({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=c;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:a,s[1]=l;for(var i=2;i<o;i++)s[i]=n[i];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},785:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>i});var r=n(7462),a=(n(7294),n(3905));const o={title:"Custom Request Adapter",sidebar_position:20},s=void 0,l={unversionedId:"tutorial/advanced/custom-http-adapter",id:"tutorial/advanced/custom-http-adapter",title:"Custom Request Adapter",description:"Remember how to create an Alova instance?",source:"@site/docs/tutorial/08-advanced/02-custom-http-adapter.md",sourceDirName:"tutorial/08-advanced",slug:"/tutorial/advanced/custom-http-adapter",permalink:"/tutorial/advanced/custom-http-adapter",draft:!1,editUrl:"https://github.com/alovajs/alovajs.github.io/blob/main/docs/tutorial/08-advanced/02-custom-http-adapter.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{title:"Custom Request Adapter",sidebar_position:20},sidebar:"tutorialSidebar",previous:{title:"Advanced Overview",permalink:"/tutorial/advanced/overview"},next:{title:"Custom Storage Adapter",permalink:"/tutorial/advanced/custom-storage-adapter"}},p={},i=[{value:"Request adapter structure",id:"request-adapter-structure",level:2},{value:"Request parameter details",id:"request-parameter-details",level:3},{value:"Return parameter details",id:"return-parameter-details",level:3},{value:"XMLHttpRequest request adapter example",id:"xmlhttprequest-request-adapter-example",level:2},{value:"request adapter type",id:"request-adapter-type",level:2}],u={toc:i};function d(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Remember how to create an Alova instance?"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const alovaInstance = createAlova({\n  //...\n  requestAdapter: GlobalFetch()\n});\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"requestAdapter")," is a request adapter. Internal request sending and receiving will depend on the request adapter. ",(0,a.kt)("inlineCode",{parentName:"p"},"GlobalFetch")," manages requests through fetch api. In most cases, we can use it. However, when ",(0,a.kt)("inlineCode",{parentName:"p"},"alova")," When running in an environment where fetch api is not available (such as app, applet), it is necessary to replace a request adapter that supports the current environment."),(0,a.kt)("p",null,"So how should you customize a request adapter? Very simple, it is actually a function, which is called every time a request is made, and returns an object, which contains such things as ",(0,a.kt)("inlineCode",{parentName:"p"},"url"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"method"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"data"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"headers"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"timeout"),", etc. Request related data sets. Although there are many fields, we only need to access the data we need."),(0,a.kt)("h2",{id:"request-adapter-structure"},"Request adapter structure"),(0,a.kt)("p",null,"The request adapter will receive request-related parameters and the currently requesting method instance, and return a set of response-related functions."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"function CustomRequestAdapter(requestElements, methodInstance) {\n  // send request...\n  return {\n    async response() {\n      // ...return the response data\n    },\n    async headers() {\n      // Asynchronous function that returns response headers\n    },\n    abort() {\n      // Interrupt request, this function will be triggered when abort is called externally\n    },\n    onDownload(updateDownloadProgress) {\n      // Download progress information, internally call updateDownloadProgress continuously to update the download progress\n    },\n    onUpload(updateUploadProgress) {\n      // Upload progress information, internally call updateUploadProgress continuously to update the upload progress\n    }\n  };\n}\n")),(0,a.kt)("h3",{id:"request-parameter-details"},"Request parameter details"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"requestElements")),(0,a.kt)("p",null,"Relevant elements of the send request, including the following data."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"interface RequestElements {\n  // request url, the get parameter is already included\n  readonly url: string;\n\n  // Request type, such as GET, POST, PUT, etc.\n  readonly type: MethodType;\n\n  // Request header information, object\n  readonly headers: Arg;\n\n  // request body information\n  readonly data?: RequestBody;\n}\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"methodInstance")),(0,a.kt)("p",null,"The method instance of the current request"),(0,a.kt)("h3",{id:"return-parameter-details"},"Return parameter details"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"response (required)")),(0,a.kt)("p",null,"An asynchronous function, the function returns the response value, which will be passed to the global response interceptor responded;"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"headers (required)")),(0,a.kt)("p",null,"An asynchronous function, the response header object returned by the function will be passed to the transformData conversion hook function of the Method instance;"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"abort (required)")),(0,a.kt)("p",null,"An ordinary function, which is used for interrupt request. When the ",(0,a.kt)("inlineCode",{parentName:"p"},"abort")," function is called in the ","[Manual Interrupt Request]","(#Manual Interrupt Request) chapter, the function that actually triggers the interrupt request is this interrupt function;"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"onDownload (optional)")),(0,a.kt)("p",null,"An ordinary function that receives a callback function that updates the download progress, and customizes the frequency of the progress update within this function, in this example simulating an update every 100 milliseconds. The ",(0,a.kt)("inlineCode",{parentName:"p"},"updateDownloadProgress")," callback function receives two parameters, the first parameter is the total size, and the second parameter is the downloaded size;"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"onUpload (optional)")),(0,a.kt)("p",null,"An ordinary function that receives a callback function that updates the upload progress, and customizes the frequency of the progress update within this function, in this example simulating an update every 100 milliseconds. The ",(0,a.kt)("inlineCode",{parentName:"p"},"updateUploadProgress")," callback function receives two parameters, the first parameter is the total size, and the second parameter is the uploaded size;"),(0,a.kt)("h2",{id:"xmlhttprequest-request-adapter-example"},"XMLHttpRequest request adapter example"),(0,a.kt)("p",null,"The following is an example of an adapter that sends requests through XMLHttpRequest, mainly to demonstrate how to write the adapter, the code is incomplete and cannot be run."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"function XMLHttpRequestAdapter(requestElements, methodInstance) {\n  // Deconstruct the data that needs to be used\n  const { url, type, data, headers } = config;\n\n  // send request\n  const xhr = new XMLHttpRequest();\n  xhr.open(type, url);\n  for (const key in headers) {\n    xhr.setRequestHeader(key, headers[key]);\n  }\n  const responsePromise = new Promise((resolve, reject) => {\n    xhr.addEventListener('load', event => {\n      // process response data\n      resolve(/* ... */);\n    });\n    xhr.addEventListener('error', event => {\n      // Handle request errors\n      reject(/* ... */);\n    });\n  });\n\n  xhr.send(JSON.stringify(data));\n\n  return {\n    // Asynchronous function that returns response data\n    response: () => responsePromise,\n\n    // Asynchronous function that returns response headers\n    headers: () => responsePromise.then(() => xhr.getAllResponseHeaders()),\n    abort: () => {\n      xhr.abort();\n    },\n\n    // Download progress information, internally call updateDownloadProgress continuously to update the download progress\n    onDownload: updateDownloadProgress => {\n      xhr.addEventListener('progress', event => {\n        // data receiving progress\n        updateDownloadProgress(event.total, event.loaded);\n      });\n    },\n\n    // Upload progress information, internally call updateUploadProgress continuously to update the upload progress\n    onUpload: updateUploadProgress => {\n      xhr.upload.onprogress = event => {\n        updateUploadProgress(event.total, event.loaded);\n      };\n    }\n  };\n}\n")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"More complete request adapter details can be found in ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/alovajs/alova/blob/main/src/predefine/GlobalFetch.ts"},"GlobalFetch source code")," to understand.")),(0,a.kt)("h2",{id:"request-adapter-type"},"request adapter type"),(0,a.kt)("p",null,"The parameters of the request adapter and the way it supports Typescript can be found in the ",(0,a.kt)("a",{parentName:"p",href:"../advanced/typescript"},"Typescript chapter"),"."))}d.isMDXComponent=!0}}]);